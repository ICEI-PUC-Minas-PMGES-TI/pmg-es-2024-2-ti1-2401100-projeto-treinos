<!DOCTYPE html>
<html>

<head>
    <title>PULSE PUMP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="radarAcademia.css">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.css" rel="stylesheet">
    <script src="script.js"></script>
</head>

<body>

    <div class="header">
        <a href="home.html"><img src="../../public/assets/images/logoclara.png" width="70" /></a>
        <nav>
            <a href="home.html">HOME</a>
            <a href="treinos.html">MEUS TREINOS</a>
            <a href="radarAcademias.html">ACADEMIAS PRÓXIMAS</a>
            <a href="perfilusuario.html"><img src="../../public/assets/images/AvatarWB.png" width="" /></a>
        </nav>
        <img src="../../public/assets/images/userplaceholder.png" class="placeholder">
    </div>

    <div class="container">

        <div class="academiasProximas">
            <p>Academias Próximas</p>
            <div class="melhorAcademia"></div>
            <div class="melhorAcademia"></div>
            <div class="melhorAcademia"></div>
        </div>

        <div class="mapaAcademias">
            <style>
                #map {
                    position: absolute;
                    width: 50rem;
                    height: 37rem;
                    border-radius: 2%;
                }
            </style>
            </head>

            <body>
                <div id="map"></div>
                <script>
                    mapboxgl.accessToken = 'pk.eyJ1IjoicmFmYWVsMTgxMCIsImEiOiJjbTJzMmMwcHcxbnpqMmtvZzdhOGY0ZzVoIn0.UCOS31bgypEm3zCvHziJUw';

                    // Verificar se o navegador suporta a API de geolocalização
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            async (position) => {
                                const userLongitude = position.coords.longitude;
                                const userLatitude = position.coords.latitude;

                                // Chamar a API de Geocodificação Reversa
                                const response = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${userLongitude},${userLatitude}.json?access_token=pk.eyJ1IjoicmFmYWVsMTgxMCIsImEiOiJjbTJzMmMwcHcxbnpqMmtvZzdhOGY0ZzVoIn0.UCOS31bgypEm3zCvHziJUw`);
                                const data = await response.json();

                                if (data.features && data.features.length > 0) {
                                    const adjustedCoordinates = data.features[0].center;

                                    // Inicializar o mapa com as coordenadas ajustadas
                                    const map = new mapboxgl.Map({
                                        container: 'map', // ID do container
                                        center: adjustedCoordinates, // Coordenadas ajustadas
                                        zoom: 15 // Nível de zoom inicial
                                    });

                                    // Criar marcador na localização ajustada com a opção de arrastar
                                    const marker = new mapboxgl.Marker({
                                        draggable: true // Permitir arrastar o marcador
                                    })
                                        .setLngLat(adjustedCoordinates)
                                        .addTo(map);

                                    // Evento para capturar novas coordenadas após o marcador ser arrastado
                                    marker.on('dragend', () => {
                                        const newCoordinates = marker.getLngLat();
                                        console.log('Nova localização ajustada pelo usuário:', newCoordinates);

                                        // Atualizar o centro do mapa para a nova localização
                                        map.setCenter([newCoordinates.lng, newCoordinates.lat]);
                                    });
                                } else {
                                    console.error('Não foi possível ajustar as coordenadas.');
                                }
                            },
                            (error) => {
                                console.error('Erro ao obter localização:', error);
                                alert('Não foi possível obter sua localização.');
                            },
                            { enableHighAccuracy: true }
                        );

                    } else {
                        alert('Geolocalização não é suportada pelo seu navegador.');
                    }
                </script>

        </div>

        <div class="footer"></div>
</body>

</html>