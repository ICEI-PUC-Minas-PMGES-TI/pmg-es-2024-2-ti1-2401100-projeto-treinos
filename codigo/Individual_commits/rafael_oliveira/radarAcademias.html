<!DOCTYPE html>
<html>

<head>
    <title>PULSE PUMP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="radarAcademia.css">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.css" rel="stylesheet">
    <script src="script.js"></script>
</head>

<body>

    <div class="header">
        <a href="home.html"><img src="../../public/assets/images/logoclara.png" width="70" /></a>
        <nav>
            <a href="home.html">HOME</a>
            <a href="treinos.html">MEUS TREINOS</a>
            <a href="radarAcademias.html">ACADEMIAS PRÓXIMAS</a>
            <a href="perfilusuario.html"><img src="../../public/assets/images/AvatarWB.png" width="" /></a>
        </nav>
        <img src="../../public/assets/images/userplaceholder.png" class="placeholder">
    </div>

    <div class="container">

        <div class="academiasProximas">
            <p>Academias Próximas</p>
            <div class="melhorAcademia"></div>
            <div class="melhorAcademia"></div>
            <div class="melhorAcademia"></div>
        </div>

        <div class="mapaAcademias">
            <style>
                #map {
                    position: absolute;
                    width: 50rem;
                    height: 37rem;
                    border-radius: 2%;
                }
            </style>
            </head>

            <body>
                <div id="map"></div>
                <script>
                    mapboxgl.accessToken = 'pk.eyJ1IjoicmFmYWVsMTgxMCIsImEiOiJjbTJzMmMwcHcxbnpqMmtvZzdhOGY0ZzVoIn0.UCOS31bgypEm3zCvHziJUw';

                    // Verificar se o navegador suporta a API de geolocalização
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                // Obter a localização atual
                                const userLongitude = position.coords.longitude;
                                const userLatitude = position.coords.latitude;

                                // Inicializar o mapa com a localização atual
                                const map = new mapboxgl.Map({
                                    container: 'map', // ID da div
                                    style: 'mapbox://styles/mapbox/streets-v11', // Estilo do mapa
                                    center: [userLongitude, userLatitude], // Localização inicial
                                    zoom: 15 // Nível de zoom inicial
                                });

                                // Adicionar controles de navegação (zoom e rotação)
                                const nav = new mapboxgl.NavigationControl();
                                map.addControl(nav, 'top-right'); // Posicionar controles no canto superior direito

                                // Criar o marcador inicial com a localização atual
                                const marker = new mapboxgl.Marker({
                                    draggable: true // Permite mover o marcador
                                })
                                    .setLngLat([userLongitude, userLatitude])
                                    .addTo(map);

                                // Listener para quando o marcador for movido
                                marker.on('dragend', () => {
                                    const newCoords = marker.getLngLat(); // Obter novas coordenadas
                                    map.flyTo({
                                        center: [newCoords.lng, newCoords.lat], // Centralizar o mapa na nova localização
                                        zoom: 15, // Mantém o mesmo nível de zoom
                                        essential: true // Garantir animação
                                    });
                                });
                            },
                            (error) => {
                                console.error('Erro ao obter localização:', error);
                                alert('Não foi possível obter sua localização.');
                            },
                            {
                                enableHighAccuracy: true, // Solicita maior precisão
                                timeout: 10000, // Tempo máximo para obter a posição (10s)
                                maximumAge: 0 // Não usa uma localização armazenada em cache
                            }
                        );
                    } else {
                        alert('Geolocalização não é suportada pelo seu navegador.');
                    }
                </script>

        </div>

    </div>

    <div class="footer"></div>
</body>

</html>